<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Proxy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .input-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .url-form {
            display: flex;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }

        .url-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .content-section {
            padding: 30px;
            min-height: 500px;
        }

        .iframe-container {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        #proxyFrame {
            width: 100%;
            height: 600px;
            border: none;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .info-box {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #bee5eb;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .feature h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .url-form {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            #proxyFrame {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê Web Proxy</h1>
            <p>Browse the web securely through our proxy server</p>
        </div>

        <div class="input-section">
            <form class="url-form" id="proxyForm">
                <input 
                    type="url" 
                    class="url-input" 
                    id="urlInput" 
                    placeholder="Enter website URL (e.g., https://example.com)" 
                    required
                >
                <button type="submit" class="btn">Browse</button>
            </form>
        </div>

        <div class="content-section">
            <div class="info-box">
                <strong>Tip:</strong> Enter any website URL above to browse through the proxy. Some sites may not work perfectly due to content security policies.
            </div>

            <div id="loading" class="loading" style="display: none;">
                <p>Loading content through proxy...</p>
            </div>

            <div id="error" class="error" style="display: none;"></div>

            <div class="iframe-container">
                <iframe id="proxyFrame" src="about:blank"></iframe>
            </div>

            <div class="features">
                <div class="feature">
                    <h3>üõ°Ô∏è Privacy</h3>
                    <p>Browse anonymously through our secure proxy server</p>
                </div>
                <div class="feature">
                    <h3>‚ö° Fast</h3>
                    <p>Optimized for quick loading and smooth browsing</p>
                </div>
                <div class="feature">
                    <h3>üîí Secure</h3>
                    <p>Encrypted connection between you and the proxy</p>
                </div>
            </div>
        </div>
    </div>

    <script>
document.getElementById('proxyForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const urlInput = document.getElementById('urlInput').value.trim();
    
    if (!urlInput) {
        showError('Please enter a URL');
        return;
    }

    // Ensure URL has protocol
    let processedUrl = urlInput;
    if (!processedUrl.startsWith('http://') && !processedUrl.startsWith('https://')) {
        processedUrl = 'https://' + processedUrl;
    }

    // Validate URL format
    try {
        new URL(processedUrl);
    } catch {
        showError('Please enter a valid URL');
        return;
    }

    loadUrl(processedUrl);
});

function loadUrl(url) {
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const iframe = document.getElementById('proxyFrame');
    
    console.log('Loading URL:', url);
    
    // Show loading, hide error and iframe
    loading.style.display = 'block';
    error.style.display = 'none';
    iframe.style.display = 'none';

    // Set iframe source to our proxy endpoint
    const proxyUrl = `/proxy?url=${encodeURIComponent(url)}`;
    
    console.log('Proxy URL:', proxyUrl);
    
    // Clear previous iframe content
    iframe.srcdoc = '';
    
    // Set iframe source
    iframe.src = proxyUrl;
    iframe.style.display = 'block';
    
    // Set a timeout to detect if iframe fails to load
    const loadTimeout = setTimeout(() => {
        if (loading.style.display !== 'none') {
            console.log('Load timeout reached');
            showError('The website is taking too long to load. It may be blocking proxy requests.');
            iframe.style.display = 'none';
            loading.style.display = 'none';
        }
    }, 10000); // 10 second timeout
    
    // Handle iframe load
    iframe.onload = function() {
        console.log('Iframe loaded successfully');
        clearTimeout(loadTimeout);
        loading.style.display = 'none';
        
        // Update URL input to show current page
        document.getElementById('urlInput').value = url;
        
        // Check if iframe contains an error page by looking for specific elements
        try {
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const errorElements = iframeDoc.querySelectorAll('[id*="error"], [class*="error"]');
            if (errorElements.length > 0) {
                console.log('Error elements detected in iframe');
            }
        } catch (e) {
            // Cross-origin restriction, ignore
            console.log('Cannot access iframe content due to security restrictions');
        }
    };
    
    iframe.onerror = function() {
        console.log('Iframe load error');
        clearTimeout(loadTimeout);
        showError('Failed to load the website. It may be blocking proxy access or there may be a network issue.');
        iframe.style.display = 'none';
        loading.style.display = 'none';
    };
}

function showError(message) {
    const error = document.getElementById('error');
    const iframe = document.getElementById('proxyFrame');
    const loading = document.getElementById('loading');
    
    console.log('Showing error:', message);
    
    error.textContent = message;
    error.style.display = 'block';
    loading.style.display = 'none';
    iframe.style.display = 'none';
}

// Test the debug endpoint on load
window.addEventListener('load', function() {
    console.log('Page loaded, testing debug endpoint...');
    
    // Test if backend is responsive
    fetch('/debug')
        .then(response => response.json())
        .then(data => {
            console.log('Debug endpoint response:', data);
        })
        .catch(error => {
            console.error('Debug endpoint failed:', error);
        });
        
    // Load welcome message in iframe
    document.getElementById('proxyFrame').srcdoc = `
        <!DOCTYPE html>
        <html>
        <head>
            <title>Web Proxy</title>
            <style>
                body { 
                    font-family: Arial, sans-serif; 
                    padding: 40px; 
                    text-align: center; 
                    color: #333;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .container {
                    max-width: 600px;
                    margin: 0 auto;
                    background: white;
                    padding: 40px;
                    border-radius: 15px;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                }
                h1 {
                    color: #2c3e50;
                    margin-bottom: 20px;
                }
                p {
                    margin: 15px 0;
                    line-height: 1.6;
                }
                code {
                    background: #f8f9fa;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-family: monospace;
                }
                .test-links {
                    margin: 20px 0;
                }
                .test-links a {
                    display: inline-block;
                    margin: 5px;
                    padding: 8px 16px;
                    background: #3498db;
                    color: white;
                    text-decoration: none;
                    border-radius: 5px;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>üöÄ Web Proxy Ready!</h1>
                <p>Enter a URL above or try one of these test sites:</p>
                <div class="test-links">
                    <a href="javascript:void(0)" onclick="parent.loadUrl('https://example.com')">example.com</a>
                    <a href="javascript:void(0)" onclick="parent.loadUrl('https://httpbin.org/html')">httpbin.org/html</a>
                    <a href="javascript:void(0)" onclick="parent.loadUrl('https://jsonplaceholder.typicode.com')">jsonplaceholder.typicode.com</a>
                </div>
                <p><small>Some websites may block proxy access due to security policies.</small></p>
                <p><small>Check the browser console for detailed debugging information.</small></p>
            </div>
        </body>
        </html>
    `;
});
    </script>
</body>
</html>
